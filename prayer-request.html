<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Prayer Request — Strategic Prayer Ministries</title>

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&family=Playfair+Display:wght@400;600;700&display=swap" rel="stylesheet">

  <!-- Your shared stylesheet -->
  <link rel="stylesheet" href="./css/styles.css" />
  
  <!-- Favicons -->
   <link rel="icon" href="favicon.ico" sizes="any"><!-- Default .ico -->
   <link rel="icon" type="image/svg+xml" href="favicon.svg"><!-- Modern browsers -->
   <link rel="apple-touch-icon" href="apple-touch-icon.png"><!-- iOS -->
   <link rel="manifest" href="site.webmanifest"><!-- Android/Chrome -->
   <meta name="theme-color" content="#0b0d13"><!-- Browser theme color -->

  <style>
    :root{
      --bg:#0f1218; --panel:#1a1f29; --gold:#f59e0b; --text:#ffffff; --muted:rgba(255,255,255,.75);
    }
    body.main{ background: var(--bg); color: var(--text); }
    .container{ max-width: 1100px; margin: 0 auto; padding: 0 1.25rem; }

    /* Header band */
    .prayer-hero{ background:#0b0d13; border-bottom:3px solid var(--gold); padding:3.5rem 0 2.25rem; text-align:center; }
    .prayer-hero h1{ font-family:'Playfair Display',serif; color:#fff; font-size:clamp(2rem,5vw,3rem); margin:0; }

    /* Scripture block */
    .scripture-block{ margin:3rem auto 1.25rem; text-align:center; }
    .gold-divider{ height:2px; background:linear-gradient(90deg,transparent,rgba(245,158,11,.85),transparent); margin:0 auto 1.5rem; width:min(92%,980px); }
    .scripture-text{ font-family:'Playfair Display',serif; font-size:clamp(1.2rem,2.6vw,1.8rem); line-height:1.6; color:#eaeaea; margin:0 0 .75rem; }
    .scripture-ref{ letter-spacing:.35em; color:rgba(255,255,255,.8); font-weight:700; font-size:.95rem; margin-bottom:1.25rem; }

    /* CTA */
    .need-wrap{ width:min(980px,92%); margin:1.75rem auto 2.25rem; text-align:center; }
    .need-title{ font-family:'Playfair Display',serif; font-size:clamp(1.8rem,4.2vw,2.6rem); color:#fff; margin:1.25rem 0 .5rem; text-shadow:0 2px 0 rgba(0,0,0,.35); }
    .need-title .accent{ color:var(--gold); }
    .need-desc{ color:var(--muted); font-size:clamp(1rem,2.2vw,1.15rem); margin:0 0 1.25rem; max-width:52ch; display:inline-block; }
    .cta{ display:inline-flex; align-items:center; justify-content:center; padding:1rem 1.5rem; min-width:280px; border-radius:999px; font-weight:800; text-transform:uppercase; letter-spacing:.08em; border:2px solid var(--gold); background:#1b1f2a; color:#e7f0ff; text-decoration:none; transition:transform .15s, box-shadow .25s, background .25s; cursor:pointer; }
    .cta:hover{ transform:translateY(-2px); background:#243043; box-shadow:0 0 0 3px rgba(245,158,11,.18), 0 10px 28px rgba(245,158,11,.25); }

    /* ========== CONFLICT-PROOF MODAL STYLES (prefixed spm-) ========== */
    .spm-overlay{
      position:fixed; inset:0; background:rgba(0,0,0,.72);
      display:none !important;   /* hidden by default */
      align-items:center; justify-content:center;
      z-index: 999999 !important;  /* above everything */
      padding:1rem;
    }
    .spm-overlay.spm-open{ display:flex !important; }

    .spm-modal{
      width:min(1000px,100%); max-height:92vh;
      background:var(--panel); border:1px solid rgba(255,255,255,.12);
      border-radius:16px; box-shadow:0 25px 80px rgba(0,0,0,.6);
      overflow:hidden; display:grid; grid-template-rows:auto 1fr;
      transform:translateY(8px); opacity:0;
      transition:transform .2s ease, opacity .2s ease;
      position:relative; z-index:1000000; /* higher than overlay just in case */
    }
    .spm-overlay.spm-open .spm-modal{ transform:translateY(0); opacity:1; }

    .spm-modal-header{
      display:flex; align-items:center; justify-content:space-between;
      padding:.9rem 1.1rem; border-bottom:1px solid rgba(255,255,255,.08); background:#121722;
    }
    .spm-modal-title{ font-family:'Playfair Display',serif; font-size:1.25rem; color:#fff; margin:0; }
    .spm-modal-close{ appearance:none; border:0; background:transparent; color:#fff; font-weight:800; letter-spacing:.08em; cursor:pointer; border:2px solid var(--gold); border-radius:9999px; padding:.55rem .9rem; }

    .spm-modal-body{ background:#fff; height:100%; }
    .spm-iframe{ width:100%; height:100%; min-height:75vh; border:0; display:block; }

    @media (max-width:640px){
      .spm-modal{ max-height:95vh; border-radius:12px; }
      .spm-iframe{ min-height:78vh; }
    }

    .disclaimer{ color:rgba(255,255,255,.7); font-style:italic; font-size:.95rem; margin:2rem auto 3rem; max-width:75ch; text-align:center; }

    /* ===== Toast (same look as contact.html) ===== */
    .toast{
      position: fixed; right: 1rem; bottom: 1rem; z-index: 1000001;
      background: #0f1218; color:#fff; border:1px solid rgba(255,255,255,.12);
      border-left: 6px solid #22c55e;
      padding: .85rem 1rem; border-radius:12px; box-shadow:0 18px 40px rgba(0,0,0,.35);
      display:none; max-width: 360px;
      font-family: 'Poppins', system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    }
    .toast.error{ border-left-color:#ef4444; }
    .toast .title{ font-weight:700; margin-bottom:.25rem; }
    .toast .msg{ opacity:.9; }
  </style>
</head>
<body class="main">

  <!-- ===== Header / Nav ===== -->
  <header class="nav" id="navbar">
    <div class="nav__inner container">
      <a class="brand" href="index.html#home">
        <img src="assets/spm-logo.png" alt="Strategic Prayer Ministries Logo" class="brand__logo" />
        <span class="brand__name">Strategic Prayer Ministries</span>
      </a>
      <button class="nav__toggle" aria-label="Open menu" aria-expanded="false" aria-controls="navLinks" id="navToggle">
        <span></span><span></span><span></span>
      </button>
      <nav class="nav__links" id="navLinks">
        <div class="nav__dropdown" id="homeDropdown">
          <button class="nav__dropdown-toggle" aria-expanded="false" aria-controls="homeDropdownMenu">Home</button>
          <div class="nav__dropdown-menu" id="homeDropdownMenu">
            <a href="index.html#links">Links</a>
            <a href="index.html#media">Gallery & Videos</a>
          </div>
        </div>
        <a href="index.html#who">Who We Are</a>
        <a href="giving.html" target="_self">Giving</a>
        <a href="contact.html" target="_self">Contact</a>
      </nav>
    </div>
  </header>

  <!-- ===== Page Title ===== -->
  <section class="prayer-hero">
    <div class="container"><h1>Prayer Request</h1></div>
  </section>

  <!-- ===== Scripture ===== -->
  <section class="container scripture-block">
    <div class="gold-divider"></div>
    <p class="scripture-text">“Who, in the days of His flesh, when he offered up prayers and supplications, with vehement 
        cries and tears to Him who was able to save him from death, and who was heard because of his goldy fear.</p>
    <div class="scripture-ref">Hebrews 5:7</div>
    <div class="gold-divider" style="margin-top:1.5rem;"></div>
  </section>

  <!-- ===== CTA ===== -->
  <section class="need-wrap">
    <h2 class="need-title"><span class="accent">Need Prayer?</span></h2>
    <p class="need-desc">Let us pray for you. Click below to open the request form.</p>
    <button id="spmOpenBtn" class="cta" aria-haspopup="dialog" aria-controls="spmModalOverlay">New Prayer Request</button>
  </section>

  <!-- ============ MODAL ============ -->
  <div id="spmModalOverlay" class="spm-overlay" role="dialog" aria-modal="true" aria-labelledby="spmModalTitle">
    <div class="spm-modal">
      <div class="spm-modal-header">
        <h3 id="spmModalTitle" class="spm-modal-title">Prayer Request Form</h3>
        <button class="spm-modal-close" id="spmCloseBtn" aria-label="Close form">Close</button>
      </div>
      <div class="spm-modal-body">
        <!-- Google Form -->
        <iframe
          id="spmIframe"
          class="spm-iframe"
          title="Prayer Request Form"
          src="https://docs.google.com/forms/d/e/1FAIpQLScCxcwJSMOjbYqUt9y64QCy0TznElxD5UCRWj9N3a7bKRkH4A/viewform?embedded=true"
          loading="eager"
          referrerpolicy="no-referrer-when-downgrade">
        </iframe>
      </div>
    </div>
  </div>

  <!-- ===== Toast (success on submit) ===== -->
  <div id="toast" class="toast" role="status" aria-live="polite" aria-atomic="true">
    <div class="title" id="toastTitle">Request submitted</div>
    <div class="msg" id="toastMsg">Thank you! Your prayer request has been received.</div>
  </div>

  <!-- ===== Footer (same as contact.html) ===== -->
  <footer class="footer">
    <div class="container">
      <div class="footer-logo-wrapper">
        <a href="index.html">
          <img src="assets/spm-logo.png" alt="Strategic Prayer Ministries Logo" class="footer-logo" />
        </a>
      </div>
      <div class="footer-container">
        <div>
          <h4>MINISTRY</h4>
          <ul>
            <li><a href="about.html">About Us</a></li>
            <li><a href="giving.html">Giving</a></li>
            <li><a href="prayer-request.html">Prayer-Request</a></li>
          </ul>
        </div>
        <div>
          <h4>RESOURCES</h4>
          <ul>
            <li><a href="index.html#media">Gallery</a></li>
            <li><a href="index.html#media">Videos</a></li>
          </ul>
        </div>
        <div>
          <h4>CONNECT WITH US</h4>
          <div class="social-badges">
            <a href="mailto:info@strategicprayer.org" class="badge badge--email" aria-label="Email us">
              <svg class="icon" viewBox="0 0 64 64" aria-hidden="true"><circle cx="32" cy="32" r="32" fill="currentColor"/><rect x="18" y="24" width="28" height="18" rx="3" fill="none" stroke="#fff" stroke-width="4"/><path d="M18 26 l14 12 L46 26" fill="none" stroke="#fff" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/></svg>
              <span>Email</span>
            </a>
            <a href="https://zoom.us/j/yourMeetingId" class="badge badge--zoom" target="_blank" rel="noopener" aria-label="Join us on Zoom">
              <svg class="icon" viewBox="0 0 64 64" aria-hidden="true"><circle cx="32" cy="32" r="32" fill="currentColor"/><rect x="18" y="24" width="22" height="16" rx="4" fill="#fff"/><polygon points="40,27 48,23 48,41 40,37" fill="#fff"/></svg>
              <span>Zoom</span>
            </a>
            <a href="https://www.youtube.com/@yourChannel" class="badge badge--youtube" target="_blank" rel="noopener" aria-label="Watch on YouTube">
              <svg class="icon" viewBox="0 0 64 64" aria-hidden="true">
                <circle cx="32" cy="32" r="32" fill="currentColor"/>
                <!-- centered play button -->
                 <polygon points="26,22 44,32 26,42" fill="#fff"/>
                </svg>
                <span>YouTube</span>
              </a>
            
            </a>
          </div>
          <div class="newsletter">
            <h4 style="margin-top:1rem;">Subscribe</h4>
            <form>
              <input type="email" placeholder="Your Email" required />
              <button type="submit">Join</button>
            </form>
          </div>
        </div>
      </div>
      <div class="scripture" id="scripture"></div>
      <div class="footer-bottom">
        <div class="footer-bottom-row">
          <p>© <span id="year"></span> Strategic Prayer Ministries. All rights reserved.</p>
          <div class="footer-links">
            <a href="#">Privacy Policy</a>
            <span>•</span>
            <a href="#">Terms &amp; Conditions</a>
          </div>
        </div>
      </div>
    </div>
  </footer>

  <script>
    // Mobile nav toggle
    const navToggle = document.getElementById('navToggle');
    const navLinks  = document.getElementById('navLinks');
    if (navToggle && navLinks) {
      navToggle.addEventListener('click', () => {
        const isExpanded = navToggle.getAttribute('aria-expanded') === 'true';
        navToggle.setAttribute('aria-expanded', String(!isExpanded));
        navLinks.classList.toggle('active');
      });
    }

    // Footer year + scripture rotation
    document.getElementById("year").textContent = new Date().getFullYear();
    const verses = [
      "“Is not my word like as a fire? saith the Lord; and like a hammer that breaketh the rock in pieces?”  Jeremiah 23:29",
      "“But they that wait upon the Lord shall renew their strength...” Isaiah 40:31",
      "“The harvest truly is plenteous, but the labourers are few...” Matthew 9:37–38"
    ];
    let i = 0;
    function showVerse(){ const el = document.getElementById("scripture"); if (el) { el.textContent = verses[i]; i = (i+1)%verses.length; } }
    showVerse(); setInterval(showVerse, 8000);

    // ===== Toast helper =====
    function showToast(title, msg, isError=false){
      const toast = document.getElementById('toast');
      const toastTitle = document.getElementById('toastTitle');
      const toastMsg = document.getElementById('toastMsg');
      toastTitle.textContent = title;
      toastMsg.textContent = msg;
      if (isError) { toast.classList.add('error'); } else { toast.classList.remove('error'); }
      toast.style.display = 'block';
      clearTimeout(showToast._t);
      showToast._t = setTimeout(()=> { toast.style.display = 'none'; }, 5500);
    }

    // ===== Modal logic with auto-close after Google Form submit =====
    const spmOpenBtn = document.getElementById('spmOpenBtn');
    const spmCloseBtn = document.getElementById('spmCloseBtn');
    const spmOverlay = document.getElementById('spmModalOverlay');
    const spmIframe  = document.getElementById('spmIframe');

    const FORM_EMBED_URL = "https://docs.google.com/forms/d/e/1FAIpQLScCxcwJSMOjbYqUt9y64QCy0TznElxD5UCRWj9N3a7bKRkH4A/viewform?embedded=true";

    let spmLoadCount = 0;
    let spmLoadListenerAttached = false;

    function attachIframeLoadListener(){
      if (spmLoadListenerAttached) return;
      spmIframe.addEventListener('load', onIframeLoad);
      spmLoadListenerAttached = true;
    }

    function detachIframeLoadListener(){
      if (!spmLoadListenerAttached) return;
      spmIframe.removeEventListener('load', onIframeLoad);
      spmLoadListenerAttached = false;
    }

    function onIframeLoad(){
      spmLoadCount += 1;

      // After submission, Google Forms shows a confirmation page (second load)
      if (spmLoadCount >= 2) {
        // Show success toast before closing
        showToast("Request submitted", "Thank you! Your prayer request has been received.");
        // Close shortly after so the toast remains visible on the page
        setTimeout(() => { spmClose(); }, 900);
      }
    }

    function spmOpen(){
      spmLoadCount = 0;

      // Always reload a fresh form when opening
      if (spmIframe) spmIframe.src = FORM_EMBED_URL;

      // Show modal
      spmOverlay.classList.add('spm-open');
      document.body.style.overflow = 'hidden';
      spmOpenBtn.setAttribute('aria-expanded', 'true');

      attachIframeLoadListener();

      // Optional fallback if iframe doesn't load
      let loaded = false;
      const tempLoad = () => { loaded = true; spmIframe.removeEventListener('load', tempLoad); };
      spmIframe.addEventListener('load', tempLoad);
      setTimeout(() => {
        if (!loaded) window.open(FORM_EMBED_URL.replace('?embedded=true',''), '_blank');
      }, 2000);
    }

    function spmClose(){
      spmOverlay.classList.remove('spm-open');
      document.body.style.overflow = '';
      spmOpenBtn.setAttribute('aria-expanded', 'false');
      spmOpenBtn.focus();
      detachIframeLoadListener();
    }

    spmOpenBtn.addEventListener('click', spmOpen);
    spmCloseBtn.addEventListener('click', spmClose);
    spmOverlay.addEventListener('click', (e) => { if (e.target === spmOverlay) spmClose(); });
    document.addEventListener('keydown', (e) => { if (e.key === 'Escape' && spmOverlay.classList.contains('spm-open')) spmClose(); });
  </script>
</body>
</html>
